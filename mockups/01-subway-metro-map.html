<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HTTP Transit Authority - Status Code Metro Map</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
*, *::before, *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    background: #0d1117;
    color: #e6edf3;
    font-family: 'Inter', sans-serif;
    overflow-x: hidden;
    min-height: 100vh;
}

.header {
    padding: 32px 48px 0;
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
}

.header-left {
    display: flex;
    align-items: center;
    gap: 20px;
}

.logo-mark {
    width: 56px;
    height: 56px;
    border-radius: 50%;
    border: 4px solid #e6edf3;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'JetBrains Mono', monospace;
    font-weight: 800;
    font-size: 18px;
    color: #e6edf3;
    background: #0d1117;
    position: relative;
}

.logo-mark::after {
    content: '';
    position: absolute;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 2px solid #e6edf3;
}

.header-title h1 {
    font-family: 'Inter', sans-serif;
    font-weight: 900;
    font-size: 32px;
    letter-spacing: -0.5px;
    text-transform: uppercase;
    line-height: 1;
    color: #ffffff;
}

.header-title .subtitle {
    font-family: 'JetBrains Mono', monospace;
    font-size: 13px;
    font-weight: 400;
    color: #8b949e;
    letter-spacing: 3px;
    text-transform: uppercase;
    margin-top: 4px;
}

.legend {
    display: flex;
    gap: 24px;
    align-items: center;
    padding: 10px 20px;
    background: rgba(22, 27, 34, 0.8);
    border: 1px solid #30363d;
    border-radius: 8px;
}

.legend-item {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 12px;
    font-weight: 500;
    color: #c9d1d9;
    white-space: nowrap;
}

.legend-line {
    width: 28px;
    height: 6px;
    border-radius: 3px;
}

.legend-code {
    font-family: 'JetBrains Mono', monospace;
    font-weight: 700;
    font-size: 11px;
}

.map-container {
    padding: 24px 48px 48px;
    position: relative;
    width: 100%;
    overflow-x: auto;
}

.map-viewport {
    position: relative;
    min-width: 1344px;
    height: 880px;
}

.metro-svg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 1;
}

.metro-line {
    fill: none;
    stroke-width: 8;
    stroke-linecap: round;
    stroke-linejoin: round;
}

.station {
    position: absolute;
    z-index: 10;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: transform 0.15s ease;
}

.station:hover {
    transform: scale(1.12);
    z-index: 20;
}

.station-dot-outer {
    width: 36px;
    height: 36px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: box-shadow 0.2s ease;
    position: relative;
}

.station:hover .station-dot-outer {
    box-shadow: 0 0 20px rgba(255, 255, 255, 0.3);
}

.station-dot-inner {
    width: 22px;
    height: 22px;
    border-radius: 50%;
    background: #0d1117;
    border: 3px solid;
    display: flex;
    align-items: center;
    justify-content: center;
}

.station-code {
    font-family: 'JetBrains Mono', monospace;
    font-weight: 700;
    font-size: 9px;
    color: #e6edf3;
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
}

.station-label {
    margin-top: 4px;
    text-align: center;
    max-width: 90px;
}

.station-label-code {
    font-family: 'JetBrains Mono', monospace;
    font-weight: 700;
    font-size: 13px;
    line-height: 1.2;
}

.station-label-name {
    font-family: 'Inter', sans-serif;
    font-weight: 400;
    font-size: 10px;
    color: #8b949e;
    line-height: 1.2;
    margin-top: 1px;
}

.station.label-top .station-label {
    order: -1;
    margin-top: 0;
    margin-bottom: 4px;
}

.detail-panel {
    position: fixed;
    z-index: 1000;
    background: #161b22;
    border: 1px solid #30363d;
    border-radius: 12px;
    padding: 20px;
    width: 320px;
    box-shadow: 0 16px 48px rgba(0, 0, 0, 0.6);
    pointer-events: none;
    opacity: 0;
    transform: translateY(8px);
    transition: opacity 0.2s ease, transform 0.2s ease;
}

.detail-panel.visible {
    opacity: 1;
    transform: translateY(0);
}

.detail-header {
    display: flex;
    align-items: center;
    gap: 14px;
    margin-bottom: 14px;
}

.detail-symbol {
    width: 52px;
    height: 52px;
    border-radius: 10px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.detail-symbol-text {
    font-family: 'JetBrains Mono', monospace;
    font-weight: 700;
    font-size: 20px;
    color: #0d1117;
    line-height: 1;
}

.detail-symbol-code {
    font-family: 'JetBrains Mono', monospace;
    font-weight: 600;
    font-size: 9px;
    color: #0d1117;
    opacity: 0.7;
    line-height: 1;
    margin-top: 2px;
}

.detail-title-area h3 {
    font-family: 'JetBrains Mono', monospace;
    font-weight: 700;
    font-size: 22px;
    color: #ffffff;
    line-height: 1.1;
}

.detail-title-area .detail-name {
    font-family: 'Inter', sans-serif;
    font-weight: 500;
    font-size: 14px;
    margin-top: 3px;
}

.detail-desc {
    font-size: 13px;
    line-height: 1.6;
    color: #c9d1d9;
    margin-bottom: 12px;
}

.detail-meta {
    display: flex;
    align-items: center;
    gap: 12px;
}

.detail-rfc {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    font-weight: 500;
    padding: 3px 8px;
    border-radius: 4px;
    background: rgba(255, 255, 255, 0.06);
    color: #8b949e;
}

.detail-cat {
    font-family: 'Inter', sans-serif;
    font-size: 11px;
    font-weight: 600;
    padding: 3px 10px;
    border-radius: 4px;
    color: #0d1117;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.line-label {
    position: absolute;
    z-index: 5;
    font-family: 'Inter', sans-serif;
    font-weight: 800;
    font-size: 11px;
    letter-spacing: 2px;
    text-transform: uppercase;
    padding: 4px 12px;
    border-radius: 4px;
    color: #0d1117;
}

.grid-texture {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image:
        radial-gradient(circle, #1c2128 1px, transparent 1px);
    background-size: 32px 32px;
    opacity: 0.3;
    pointer-events: none;
    z-index: 0;
}

.map-border {
    position: absolute;
    top: 12px;
    left: 12px;
    right: 12px;
    bottom: 12px;
    border: 1px solid #21262d;
    border-radius: 4px;
    pointer-events: none;
    z-index: 0;
}

.footer {
    padding: 0 48px 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.footer-text {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: #484f58;
}

.search-box {
    position: relative;
    margin-left: auto;
    margin-right: 24px;
}

.search-input {
    background: #161b22;
    border: 1px solid #30363d;
    border-radius: 6px;
    padding: 8px 12px 8px 32px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    color: #e6edf3;
    width: 200px;
    outline: none;
    transition: border-color 0.2s, width 0.2s;
}

.search-input:focus {
    border-color: #58a6ff;
    width: 260px;
}

.search-input::placeholder {
    color: #484f58;
}

.search-icon {
    position: absolute;
    left: 10px;
    top: 50%;
    transform: translateY(-50%);
    color: #484f58;
    font-size: 14px;
    pointer-events: none;
}

.station.dimmed {
    opacity: 0.15;
}

.station.highlighted .station-dot-outer {
    animation: pulse 1s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.2); }
    50% { box-shadow: 0 0 16px 4px rgba(255, 255, 255, 0.35); }
}

.metro-line.dimmed {
    opacity: 0.1;
}

@media (max-width: 1400px) {
    .map-viewport {
        min-width: 1200px;
    }
}
</style>
</head>
<body>

<div class="header">
    <div class="header-left">
        <div class="logo-mark">HT</div>
        <div class="header-title">
            <h1>HTTP Transit Authority</h1>
            <div class="subtitle">Official Status Code Metro Map</div>
        </div>
    </div>
    <div style="display:flex;align-items:center;">
        <div class="search-box">
            <svg class="search-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
            <input type="text" class="search-input" placeholder="Search codes... ( / )" id="searchInput">
        </div>
        <div class="legend" id="legend"></div>
    </div>
</div>

<div class="map-container">
    <div class="map-viewport" id="mapViewport">
        <div class="grid-texture"></div>
        <div class="map-border"></div>
        <svg class="metro-svg" id="metroSvg" xmlns="http://www.w3.org/2000/svg"></svg>
    </div>
</div>

<div class="footer">
    <div class="footer-text">Not for navigation. All routes are informational only.</div>
    <div class="footer-text">v1.0 -- HTTP/1.1 &amp; HTTP/2 Status Codes</div>
</div>

<div class="detail-panel" id="detailPanel"></div>

<script>
const STATUS_CODES = [
    { code: 100, name: "Continue", symbol: "Cn", cat: "1xx", desc: "The server has received the request headers and the client should proceed to send the request body.", rfc: "RFC 9110" },
    { code: 101, name: "Switching Protocols", symbol: "Sw", cat: "1xx", desc: "The server is switching protocols as requested by the client via the Upgrade header.", rfc: "RFC 9110" },
    { code: 103, name: "Early Hints", symbol: "Eh", cat: "1xx", desc: "Used to return some response headers before the final HTTP message.", rfc: "RFC 8297" },
    { code: 200, name: "OK", symbol: "Ok", cat: "2xx", desc: "The request has succeeded.", rfc: "RFC 9110" },
    { code: 201, name: "Created", symbol: "Cr", cat: "2xx", desc: "The request has been fulfilled and a new resource has been created.", rfc: "RFC 9110" },
    { code: 202, name: "Accepted", symbol: "Ac", cat: "2xx", desc: "The request has been accepted for processing, but processing has not been completed.", rfc: "RFC 9110" },
    { code: 203, name: "Non-Authoritative", symbol: "Na", cat: "2xx", desc: "The returned metadata is not exactly the same as available from the origin server.", rfc: "RFC 9110" },
    { code: 204, name: "No Content", symbol: "Nc", cat: "2xx", desc: "The server has successfully fulfilled the request and there is no additional content.", rfc: "RFC 9110" },
    { code: 205, name: "Reset Content", symbol: "Rc", cat: "2xx", desc: "The server has fulfilled the request and the user agent should reset the document view.", rfc: "RFC 9110" },
    { code: 206, name: "Partial Content", symbol: "Pc", cat: "2xx", desc: "The server is delivering only part of the resource due to a Range header.", rfc: "RFC 9110" },
    { code: 207, name: "Multi-Status", symbol: "Ms", cat: "2xx", desc: "A WebDAV response conveying information about multiple resources.", rfc: "RFC 4918" },
    { code: 208, name: "Already Reported", symbol: "Ar", cat: "2xx", desc: "Used inside a WebDAV response to avoid enumerating internal members repeatedly.", rfc: "RFC 5842" },
    { code: 226, name: "IM Used", symbol: "Im", cat: "2xx", desc: "The server has fulfilled a GET request with instance-manipulations applied.", rfc: "RFC 3229" },
    { code: 300, name: "Multiple Choices", symbol: "Mc", cat: "3xx", desc: "The request has more than one possible response.", rfc: "RFC 9110" },
    { code: 301, name: "Moved Permanently", symbol: "Mp", cat: "3xx", desc: "The URL of the requested resource has been changed permanently.", rfc: "RFC 9110" },
    { code: 302, name: "Found", symbol: "Fd", cat: "3xx", desc: "The URI of the requested resource has been changed temporarily.", rfc: "RFC 9110" },
    { code: 303, name: "See Other", symbol: "So", cat: "3xx", desc: "The server is redirecting to a different resource using GET.", rfc: "RFC 9110" },
    { code: 304, name: "Not Modified", symbol: "Nm", cat: "3xx", desc: "The resource has not been modified since the version specified.", rfc: "RFC 9110" },
    { code: 305, name: "Use Proxy", symbol: "Up", cat: "3xx", desc: "The requested resource must be accessed through a proxy. Deprecated.", rfc: "Deprecated" },
    { code: 307, name: "Temporary Redirect", symbol: "Tr", cat: "3xx", desc: "The server is redirecting to another URI with same method.", rfc: "RFC 9110" },
    { code: 308, name: "Permanent Redirect", symbol: "Pr", cat: "3xx", desc: "The resource has permanently moved, same method required.", rfc: "RFC 9110" },
    { code: 400, name: "Bad Request", symbol: "Br", cat: "4xx", desc: "The server cannot process the request due to a client error.", rfc: "RFC 9110" },
    { code: 401, name: "Unauthorized", symbol: "Un", cat: "4xx", desc: "The request requires authentication.", rfc: "RFC 9110" },
    { code: 402, name: "Payment Required", symbol: "Py", cat: "4xx", desc: "Reserved for future use. Some APIs use it for billing limits.", rfc: "RFC 9110" },
    { code: 403, name: "Forbidden", symbol: "Fb", cat: "4xx", desc: "The client does not have access rights.", rfc: "RFC 9110" },
    { code: 404, name: "Not Found", symbol: "Nf", cat: "4xx", desc: "The server cannot find the requested resource.", rfc: "RFC 9110" },
    { code: 405, name: "Method Not Allowed", symbol: "Ma", cat: "4xx", desc: "The request method is not supported for that resource.", rfc: "RFC 9110" },
    { code: 406, name: "Not Acceptable", symbol: "Nx", cat: "4xx", desc: "The server can't produce a matching response.", rfc: "RFC 9110" },
    { code: 407, name: "Proxy Auth Required", symbol: "Pa", cat: "4xx", desc: "Authentication needs to be done by a proxy.", rfc: "RFC 9110" },
    { code: 408, name: "Request Timeout", symbol: "Rt", cat: "4xx", desc: "The server would like to shut down this unused connection.", rfc: "RFC 9110" },
    { code: 409, name: "Conflict", symbol: "Cf", cat: "4xx", desc: "The request conflicts with the current state of the server.", rfc: "RFC 9110" },
    { code: 410, name: "Gone", symbol: "Gn", cat: "4xx", desc: "The content has been permanently deleted.", rfc: "RFC 9110" },
    { code: 411, name: "Length Required", symbol: "Lr", cat: "4xx", desc: "Content-Length header is not defined.", rfc: "RFC 9110" },
    { code: 412, name: "Precondition Failed", symbol: "Pf", cat: "4xx", desc: "Preconditions in request headers are not met.", rfc: "RFC 9110" },
    { code: 413, name: "Content Too Large", symbol: "Tl", cat: "4xx", desc: "Request entity is larger than server limits.", rfc: "RFC 9110" },
    { code: 414, name: "URI Too Long", symbol: "Ul", cat: "4xx", desc: "The URI is longer than the server will interpret.", rfc: "RFC 9110" },
    { code: 415, name: "Unsupported Media", symbol: "Um", cat: "4xx", desc: "The media format is not supported.", rfc: "RFC 9110" },
    { code: 416, name: "Range Not Satisfiable", symbol: "Rn", cat: "4xx", desc: "The range specified can't be fulfilled.", rfc: "RFC 9110" },
    { code: 417, name: "Expectation Failed", symbol: "Ef", cat: "4xx", desc: "The Expect header expectation can't be met.", rfc: "RFC 9110" },
    { code: 418, name: "I'm a Teapot", symbol: "Tp", cat: "4xx", desc: "An April Fools' joke from 1998 that became beloved.", rfc: "RFC 2324" },
    { code: 421, name: "Misdirected", symbol: "Mr", cat: "4xx", desc: "The request was directed at a wrong server.", rfc: "RFC 9110" },
    { code: 422, name: "Unprocessable", symbol: "Uc", cat: "4xx", desc: "Well-formed but semantically erroneous.", rfc: "RFC 9110" },
    { code: 423, name: "Locked", symbol: "Lk", cat: "4xx", desc: "The resource is locked (WebDAV).", rfc: "RFC 4918" },
    { code: 424, name: "Failed Dependency", symbol: "Dp", cat: "4xx", desc: "Failed due to failure of a previous request.", rfc: "RFC 4918" },
    { code: 425, name: "Too Early", symbol: "Te", cat: "4xx", desc: "Server won't risk processing a replay.", rfc: "RFC 8470" },
    { code: 426, name: "Upgrade Required", symbol: "Ur", cat: "4xx", desc: "Server refuses current protocol.", rfc: "RFC 9110" },
    { code: 428, name: "Precondition Req'd", symbol: "Pq", cat: "4xx", desc: "The server requires conditional requests.", rfc: "RFC 6585" },
    { code: 429, name: "Too Many Requests", symbol: "Tm", cat: "4xx", desc: "Rate limited.", rfc: "RFC 6585" },
    { code: 431, name: "Headers Too Large", symbol: "Hl", cat: "4xx", desc: "Header fields are too large.", rfc: "RFC 6585" },
    { code: 451, name: "Legal Reasons", symbol: "Lg", cat: "4xx", desc: "Unavailable for legal reasons.", rfc: "RFC 7725" },
    { code: 500, name: "Internal Error", symbol: "Is", cat: "5xx", desc: "Unhandled server exception.", rfc: "RFC 9110" },
    { code: 501, name: "Not Implemented", symbol: "Ni", cat: "5xx", desc: "The request method is not supported.", rfc: "RFC 9110" },
    { code: 502, name: "Bad Gateway", symbol: "Bg", cat: "5xx", desc: "Invalid response from upstream server.", rfc: "RFC 9110" },
    { code: 503, name: "Service Unavailable", symbol: "Su", cat: "5xx", desc: "Server not ready -- maintenance or overloaded.", rfc: "RFC 9110" },
    { code: 504, name: "Gateway Timeout", symbol: "Gt", cat: "5xx", desc: "Gateway didn't get a response in time.", rfc: "RFC 9110" },
    { code: 505, name: "HTTP Ver. Unsupported", symbol: "Hv", cat: "5xx", desc: "HTTP version not supported.", rfc: "RFC 9110" },
    { code: 506, name: "Variant Negotiates", symbol: "Vn", cat: "5xx", desc: "Internal configuration error.", rfc: "RFC 2295" },
    { code: 507, name: "Insufficient Storage", symbol: "St", cat: "5xx", desc: "Server can't store the representation.", rfc: "RFC 4918" },
    { code: 508, name: "Loop Detected", symbol: "Ld", cat: "5xx", desc: "Infinite loop detected (WebDAV).", rfc: "RFC 5842" },
    { code: 510, name: "Not Extended", symbol: "Ne", cat: "5xx", desc: "Further extensions required.", rfc: "RFC 2774" },
    { code: 511, name: "Network Auth Req'd", symbol: "Nr", cat: "5xx", desc: "Client needs to authenticate for network access.", rfc: "RFC 6585" },
];

const CAT_COLORS = { '1xx': '#58a6ff', '2xx': '#3fb950', '3xx': '#d29922', '4xx': '#ff7b72', '5xx': '#bc8cff' };
const CAT_LABELS = { '1xx': 'Informational', '2xx': 'Success', '3xx': 'Redirection', '4xx': 'Client Error', '5xx': 'Server Error' };
const CAT_LINE_NAMES = { '1xx': 'Blue Line', '2xx': 'Green Line', '3xx': 'Yellow Line', '4xx': 'Red Line', '5xx': 'Purple Line' };

// Layout config
const LINE_CONFIG = {
    '1xx': { y: 80, startX: 120 },
    '2xx': { y: 210, startX: 70 },
    '3xx': { y: 350, startX: 120 },
    '4xx': { y: 500, startX: 50 },
    '5xx': { y: 760, startX: 100 },
};

const STATION_SPACING = {
    '1xx': 140,
    '2xx': 115,
    '3xx': 140,
    '4xx': 82,
    '5xx': 115,
};

// Group codes by category
const codesByCategory = {};
['1xx', '2xx', '3xx', '4xx', '5xx'].forEach(function(cat) {
    codesByCategory[cat] = STATUS_CODES.filter(function(s) { return s.cat === cat; });
});

// Compute station positions
const stationPositions = {};

Object.keys(LINE_CONFIG).forEach(function(cat) {
    var config = LINE_CONFIG[cat];
    var codes = codesByCategory[cat];
    var spacing = STATION_SPACING[cat];

    codes.forEach(function(sc, i) {
        if (cat === '4xx') {
            var firstRowCount = 15;
            if (i < firstRowCount) {
                stationPositions[sc.code] = {
                    x: config.startX + i * spacing,
                    y: config.y,
                    labelPos: (i % 2 === 0) ? 'bottom' : 'top'
                };
            } else {
                var bendX = config.startX + (firstRowCount - 1) * spacing;
                var newRowI = i - firstRowCount;
                stationPositions[sc.code] = {
                    x: bendX - newRowI * spacing,
                    y: config.y + 120,
                    labelPos: (newRowI % 2 === 0) ? 'bottom' : 'top'
                };
            }
        } else {
            var labelPos = (i % 2 === 0) ? 'bottom' : 'top';
            stationPositions[sc.code] = {
                x: config.startX + i * spacing,
                y: config.y,
                labelPos: labelPos
            };
        }
    });
});

// Build Legend using DOM methods
var legendEl = document.getElementById('legend');
['1xx', '2xx', '3xx', '4xx', '5xx'].forEach(function(cat) {
    var item = document.createElement('div');
    item.className = 'legend-item';

    var line = document.createElement('div');
    line.className = 'legend-line';
    line.style.background = CAT_COLORS[cat];
    item.appendChild(line);

    var code = document.createElement('span');
    code.className = 'legend-code';
    code.style.color = CAT_COLORS[cat];
    code.textContent = cat;
    item.appendChild(code);

    var name = document.createElement('span');
    name.textContent = CAT_LABELS[cat];
    item.appendChild(name);

    legendEl.appendChild(item);
});

// Draw SVG Lines
var svg = document.getElementById('metroSvg');

function buildLinePath(cat) {
    var codes = codesByCategory[cat];
    var points = codes.map(function(sc) { return stationPositions[sc.code]; });
    if (points.length < 2) return '';

    var d = 'M ' + points[0].x + ' ' + points[0].y;

    for (var i = 1; i < points.length; i++) {
        var prev = points[i - 1];
        var curr = points[i];

        if (prev.y === curr.y) {
            d += ' L ' + curr.x + ' ' + curr.y;
        } else {
            // Metro-style bend: go horizontal partway, then diagonal, then horizontal
            var dy = curr.y - prev.y;
            var diagLen = Math.abs(dy);
            if (curr.x < prev.x) {
                // Going left and down
                var turnX = curr.x + diagLen;
                d += ' L ' + turnX + ' ' + prev.y;
                d += ' L ' + curr.x + ' ' + curr.y;
            } else {
                var turnX2 = prev.x + diagLen;
                d += ' L ' + turnX2 + ' ' + prev.y;
                d += ' L ' + curr.x + ' ' + curr.y;
            }
        }
    }

    return d;
}

function drawLine(cat) {
    var codes = codesByCategory[cat];
    var points = codes.map(function(sc) { return stationPositions[sc.code]; });
    var color = CAT_COLORS[cat];

    if (points.length < 2) return;

    // Main line path
    var path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
    path.setAttribute('d', buildLinePath(cat));
    path.setAttribute('class', 'metro-line');
    path.setAttribute('data-cat', cat);
    path.setAttribute('stroke', color);
    path.setAttribute('opacity', '0.6');
    svg.appendChild(path);

    // Leading tail
    var tailLen = 30;
    var first = points[0];
    var tailStart = document.createElementNS('http://www.w3.org/2000/svg', 'line');
    tailStart.setAttribute('x1', first.x - tailLen);
    tailStart.setAttribute('y1', first.y);
    tailStart.setAttribute('x2', first.x);
    tailStart.setAttribute('y2', first.y);
    tailStart.setAttribute('stroke', color);
    tailStart.setAttribute('stroke-width', '8');
    tailStart.setAttribute('stroke-linecap', 'round');
    tailStart.setAttribute('opacity', '0.6');
    tailStart.setAttribute('class', 'metro-line');
    tailStart.setAttribute('data-cat', cat);
    svg.appendChild(tailStart);

    // Trailing tail - direction depends on last segment direction
    var last = points[points.length - 1];
    var secondLast = points[points.length - 2];
    var tailDirX = (last.x >= secondLast.x) ? tailLen : -tailLen;
    var tailEnd = document.createElementNS('http://www.w3.org/2000/svg', 'line');
    tailEnd.setAttribute('x1', last.x);
    tailEnd.setAttribute('y1', last.y);
    tailEnd.setAttribute('x2', last.x + tailDirX);
    tailEnd.setAttribute('y2', last.y);
    tailEnd.setAttribute('stroke', color);
    tailEnd.setAttribute('stroke-width', '8');
    tailEnd.setAttribute('stroke-linecap', 'round');
    tailEnd.setAttribute('opacity', '0.6');
    tailEnd.setAttribute('class', 'metro-line');
    tailEnd.setAttribute('data-cat', cat);
    svg.appendChild(tailEnd);

    // Line label
    var viewport = document.getElementById('mapViewport');
    var label = document.createElement('div');
    label.className = 'line-label';
    label.style.background = color;
    label.style.left = (first.x - tailLen - 8) + 'px';
    label.style.top = (first.y - 30) + 'px';
    label.textContent = CAT_LINE_NAMES[cat];
    viewport.appendChild(label);
}

['1xx', '2xx', '3xx', '4xx', '5xx'].forEach(drawLine);

// Create Station Elements
var viewport = document.getElementById('mapViewport');

STATUS_CODES.forEach(function(sc) {
    var pos = stationPositions[sc.code];
    var color = CAT_COLORS[sc.cat];

    var station = document.createElement('div');
    station.className = 'station' + (pos.labelPos === 'top' ? ' label-top' : '');
    station.setAttribute('data-code', sc.code);
    station.setAttribute('data-cat', sc.cat);
    station.style.left = (pos.x - 18) + 'px';
    station.style.top = (pos.y - 18) + 'px';

    // Build station DOM safely
    var dotOuter = document.createElement('div');
    dotOuter.className = 'station-dot-outer';
    dotOuter.style.background = color;

    var dotInner = document.createElement('div');
    dotInner.className = 'station-dot-inner';
    dotInner.style.borderColor = color;
    dotOuter.appendChild(dotInner);

    var codeSpan = document.createElement('span');
    codeSpan.className = 'station-code';
    codeSpan.textContent = sc.symbol;
    dotOuter.appendChild(codeSpan);

    var labelDiv = document.createElement('div');
    labelDiv.className = 'station-label';

    var labelCode = document.createElement('div');
    labelCode.className = 'station-label-code';
    labelCode.style.color = color;
    labelCode.textContent = sc.code;
    labelDiv.appendChild(labelCode);

    var labelName = document.createElement('div');
    labelName.className = 'station-label-name';
    labelName.textContent = sc.name;
    labelDiv.appendChild(labelName);

    station.appendChild(dotOuter);
    station.appendChild(labelDiv);

    viewport.appendChild(station);

    station.addEventListener('mouseenter', function(e) { showDetail(sc, e); });
    station.addEventListener('mouseleave', hideDetail);
});

// Detail Panel
var detailPanel = document.getElementById('detailPanel');

function showDetail(sc, e) {
    var color = CAT_COLORS[sc.cat];

    // Clear panel
    while (detailPanel.firstChild) {
        detailPanel.removeChild(detailPanel.firstChild);
    }

    // Header
    var header = document.createElement('div');
    header.className = 'detail-header';

    var symbolBox = document.createElement('div');
    symbolBox.className = 'detail-symbol';
    symbolBox.style.background = color;

    var symText = document.createElement('div');
    symText.className = 'detail-symbol-text';
    symText.textContent = sc.symbol;
    symbolBox.appendChild(symText);

    var symCode = document.createElement('div');
    symCode.className = 'detail-symbol-code';
    symCode.textContent = sc.code;
    symbolBox.appendChild(symCode);

    header.appendChild(symbolBox);

    var titleArea = document.createElement('div');
    titleArea.className = 'detail-title-area';

    var h3 = document.createElement('h3');
    h3.textContent = sc.code;
    titleArea.appendChild(h3);

    var detailName = document.createElement('div');
    detailName.className = 'detail-name';
    detailName.style.color = color;
    detailName.textContent = sc.name;
    titleArea.appendChild(detailName);

    header.appendChild(titleArea);
    detailPanel.appendChild(header);

    // Description
    var desc = document.createElement('div');
    desc.className = 'detail-desc';
    desc.textContent = sc.desc;
    detailPanel.appendChild(desc);

    // Meta
    var meta = document.createElement('div');
    meta.className = 'detail-meta';

    var rfc = document.createElement('span');
    rfc.className = 'detail-rfc';
    rfc.textContent = sc.rfc;
    meta.appendChild(rfc);

    var catBadge = document.createElement('span');
    catBadge.className = 'detail-cat';
    catBadge.style.background = color;
    catBadge.textContent = CAT_LABELS[sc.cat];
    meta.appendChild(catBadge);

    detailPanel.appendChild(meta);

    // Position
    var rect = e.currentTarget.getBoundingClientRect();
    var left = rect.right + 16;
    var top = rect.top - 20;

    if (left + 340 > window.innerWidth) {
        left = rect.left - 340;
    }
    if (top + 200 > window.innerHeight) {
        top = window.innerHeight - 220;
    }
    if (top < 10) top = 10;

    detailPanel.style.left = left + 'px';
    detailPanel.style.top = top + 'px';
    detailPanel.classList.add('visible');
}

function hideDetail() {
    detailPanel.classList.remove('visible');
}

// Search
var searchInput = document.getElementById('searchInput');
searchInput.addEventListener('input', function() {
    var query = searchInput.value.toLowerCase().trim();
    var stations = document.querySelectorAll('.station');
    var lines = document.querySelectorAll('.metro-line');

    if (!query) {
        stations.forEach(function(s) {
            s.classList.remove('dimmed', 'highlighted');
        });
        lines.forEach(function(l) { l.classList.remove('dimmed'); });
        return;
    }

    var matchingCats = {};

    stations.forEach(function(s) {
        var code = s.getAttribute('data-code');
        var cat = s.getAttribute('data-cat');
        var sc = STATUS_CODES.find(function(c) { return c.code == code; });

        var match = code.indexOf(query) !== -1 ||
            sc.name.toLowerCase().indexOf(query) !== -1 ||
            sc.symbol.toLowerCase().indexOf(query) !== -1 ||
            sc.desc.toLowerCase().indexOf(query) !== -1 ||
            sc.rfc.toLowerCase().indexOf(query) !== -1;

        if (match) {
            s.classList.remove('dimmed');
            s.classList.add('highlighted');
            matchingCats[cat] = true;
        } else {
            s.classList.add('dimmed');
            s.classList.remove('highlighted');
        }
    });

    lines.forEach(function(l) {
        var cat = l.getAttribute('data-cat');
        if (matchingCats[cat]) {
            l.classList.remove('dimmed');
        } else {
            l.classList.add('dimmed');
        }
    });
});

// Keyboard shortcuts
document.addEventListener('keydown', function(e) {
    if (e.key === '/' && document.activeElement !== searchInput) {
        e.preventDefault();
        searchInput.focus();
    }
    if (e.key === 'Escape') {
        searchInput.value = '';
        searchInput.dispatchEvent(new Event('input'));
        searchInput.blur();
    }
});
</script>

</body>
</html>
